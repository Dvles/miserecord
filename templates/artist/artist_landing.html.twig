{% extends 'base.html.twig' %}

{% block title %}Artist Landing Page{% endblock %}

{% block body %}
    <div class="container" style="position: relative; height: 100vh; overflow: hidden;">
        <div class="artists-gallery row row-cols-1 row-cols-md-3 g-4">
            {% for artist in artists %}
                <div class="col artist-container">
                    <div class="artist-photo-wrapper">
                        {% if artist.artistPhotos|length > 0 %}
                            <!-- Image only, no text -->
                            <a href="{{ path('artist_profile', {'artist_id': artist.id}) }}">
                                <img src="{{ asset(artist.artistPhotos|first.filePath) }}" alt="{{ artist.artistName }}" class="img-fluid artist-img artist-image">
                            </a>
                        {% else %}
                            <!-- Placeholder Image if no artist photo is available -->
                            <img src="{{ asset('default_artwork.jpg') }}" alt="No Artist Image" class="img-fluid artist-img artist-image">
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- GSAP and ScrollTrigger CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/Draggable.min.js"></script> <!-- GSAP Draggable plugin -->

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM loaded, initializing GSAP animations');

            // Check if GSAP is loaded
            if (typeof gsap === 'undefined') {
                console.error('GSAP is not loaded!');
                return;
            }
            console.log('GSAP loaded successfully');

            // Check if ScrollTrigger and Flip plugins are available
            if (typeof ScrollTrigger === 'undefined') {
                console.error('ScrollTrigger plugin is not loaded!');
            } else {
                console.log('ScrollTrigger loaded successfully');
            }
            if (typeof Draggable === 'undefined') {
                console.error('Draggable plugin is not loaded!');
            } else {
                console.log('Draggable plugin loaded successfully');
            }

            // Position the artist images randomly using GSAP and load images on scroll
            const artistImages = document.querySelectorAll(".artist-image");

            artistImages.forEach((image, index) => {
                // Set the image in a random position within the container
                gsap.set(image, {
                    x: gsap.utils.random(0, window.innerWidth - 200), // Random x position (200px is for the width of the image)
                    y: gsap.utils.random(0, window.innerHeight - 200), // Random y position (200px is for the height of the image)
                    opacity: 0,  // Start with opacity 0 (invisible)
                    scale: 0.5,  // Start with smaller scale
                });

                // GSAP ScrollTrigger to animate the images when they appear on the screen
                gsap.to(image, {
                    opacity: 1, // Fade the image in
                    scale: 1,   // Scale to full size
                    duration: 1.5,
                    delay: index * 0.1, // Stagger the animation by 0.1 seconds for each image
                    scrollTrigger: {
                        trigger: image, // Trigger the animation when the image enters the viewport
                        start: "top 80%", // When the image enters 80% of the viewport
                        end: "top 30%", // End the animation when the top of the image hits 30% of the viewport
                        scrub: true, // Makes the animation follow the scroll smoothly
                        once: true, // Trigger animation once
                    },
                    onStart: () => console.log(`GSAP animation started for .artist-image ${index}`),
                    onComplete: () => console.log(`GSAP animation completed for .artist-image ${index}`)
                });

                // Making the image draggable using GSAP Draggable plugin
                Draggable.create(image, {
                    type: "x,y", // Allow dragging in both x and y directions
                    bounds: window, // Limit the drag within the window
                    edgeResistance: 0.65, // Resistance when dragging near the edge
                    onDrag: function () {
                        console.log(`Dragging image: ${index}`); // Debug log
                    },
                    onThrowUpdate: function () {
                        console.log(`Throwing image: ${index}`); // Debug log
                    },
                });
            });
        });
    </script>
{% endblock %}
